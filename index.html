<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5 Synth Keyboard</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #222; color: white; font-family: sans-serif; margin: 0; }
        h1 { margin-bottom: 20px; }
        
        .piano { display: flex; position: relative; height: 250px; padding: 10px; background: #111; border-radius: 10px; border: 4px solid #444; }
        
        /* White Keys */
        .key { position: relative; width: 60px; height: 100%; background: white; border: 1px solid #ccc; border-radius: 0 0 5px 5px; cursor: pointer; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 10px; color: #555; font-weight: bold; transition: background 0.1s; user-select: none; }
        .key.active { background: #ddd; height: 98%; }

        /* Black Keys */
        .key.black { position: absolute; width: 35px; height: 60%; background: #000; color: white; border: none; z-index: 2; margin-left: -17.5px; border-radius: 0 0 3px 3px; }
        .key.black.active { background: #333; }

        /* Positioning the Black Keys specifically */
        .key[data-note="C#4"] { left: 52px; }
        .key[data-note="D#4"] { left: 112px; }
        .key[data-note="F#4"] { left: 232px; }
        .key[data-note="G#4"] { left: 292px; }
        .key[data-note="A#4"] { left: 352px; }
    </style>
</head>
<body>

    <h1>Web Audio Piano</h1>
    <p>Use your mouse or keyboard: <strong>A S D F G H J</strong> (White) | <strong>W E T Y U</strong> (Black)</p>

    <div class="piano" id="piano">
        <div class="key" data-note="C4" data-key="a">A</div>
        <div class="key black" data-note="C#4" data-key="w">W</div>
        <div class="key" data-note="D4" data-key="s">S</div>
        <div class="key black" data-note="D#4" data-key="e">E</div>
        <div class="key" data-note="E4" data-key="d">D</div>
        <div class="key" data-note="F4" data-key="f">F</div>
        <div class="key black" data-note="F#4" data-key="t">T</div>
        <div class="key" data-note="G4" data-key="g">G</div>
        <div class="key black" data-note="G#4" data-key="y">Y</div>
        <div class="key" data-note="A4" data-key="h">H</div>
        <div class="key black" data-note="A#4" data-key="u">U</div>
        <div class="key" data-note="B4" data-key="j">J</div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const activeNodes = {};

        // Frequency Map for Middle C Octave
        const noteFrequencies = {
            "C4": 261.63, "C#4": 277.18, "D4": 293.66, "D#4": 311.13,
            "E4": 329.63, "F4": 349.23, "F#4": 369.99, "G4": 392.00,
            "G#4": 415.30, "A4": 440.00, "A#4": 466.16, "B4": 493.88
        };

        function playNote(note) {
            if (activeNodes[note]) return; // Already playing

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'triangle'; // 'sine', 'square', 'sawtooth', 'triangle'
            osc.frequency.setValueAtTime(noteFrequencies[note], audioCtx.currentTime);

            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1);

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            activeNodes[note] = { osc, gain };

            // Visual Feedback
            const keyEl = document.querySelector(`[data-note="${note}"]`);
            if (keyEl) keyEl.classList.add('active');
        }

        function stopNote(note) {
            if (activeNodes[note]) {
                activeNodes[note].osc.stop(audioCtx.currentTime + 0.1);
                delete activeNodes[note];
            }
            const keyEl = document.querySelector(`[data-note="${note}"]`);
            if (keyEl) keyEl.classList.remove('active');
        }

        // --- Event Listeners ---

        // Mouse Events
        document.querySelectorAll('.key').forEach(key => {
            key.addEventListener('mousedown', () => playNote(key.dataset.note));
            key.addEventListener('mouseup', () => stopNote(key.dataset.note));
            key.addEventListener('mouseleave', () => stopNote(key.dataset.note));
        });

        // Keyboard Events
        window.addEventListener('keydown', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const key = e.key.toLowerCase();
            const keyEl = document.querySelector(`[data-key="${key}"]`);
            if (keyEl) playNote(keyEl.dataset.note);
        });

        window.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            const keyEl = document.querySelector(`[data-key="${key}"]`);
            if (keyEl) stopNote(keyEl.dataset.note);
        });
    </script>
</body>
</html>